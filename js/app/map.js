(function(){var t={}.hasOwnProperty,o=function(o,e){function n(){this.constructor=o}for(var r in e)t.call(e,r)&&(o[r]=e[r]);return n.prototype=e.prototype,o.prototype=new n,o.__super__=e.prototype,o};require(["handlebars","jquery","jquery-cookie","underscore","backbone","geoPosition","async!http://maps.google.com/maps/api/js?sensor=false&v=3"],function(t){var e,n,r;return r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.initialize=function(){},e}(Backbone.Model),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.model=r,e.prototype.initialize=function(t){return t&&t.url?this.url=t.url:void 0},e.prototype.comparator=function(t){return t.get("id")},e}(Backbone.Collection),e=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return o(r,e),r.prototype.el=$("#map"),r.prototype.center=null,r.prototype.map_id="#my_map",r.prototype.map=null,r.prototype.width="100%",r.prototype.height="100%",r.prototype.markers=[],r.prototype.centerMarker=null,r.prototype.bounds=null,r.prototype.opts={},r.prototype.initialize=function(t){return t?(this.opts=t,t.width&&(this.width=t.width),t.height&&(this.height=t.height)):t={},this.storedPosition()?this.center=this.storedPosition():this.getBrowserGeolocation(),$(this.el).length?this.render(t):void 0},r.prototype.render=function(t){var o;return $(this.el).append("<div id='"+this.map_id+"' style='width: "+this.width+"; height: "+this.height+";'></div>"),o={zoom:12,center:new google.maps.LatLng(this.center.lat,this.center.lng)},this.map=new google.maps.Map(document.getElementById(this.map_id),o),this.bounds=new google.maps.LatLngBounds,t.yourPositionMarker===!0&&this.setCenterMarker(new google.maps.LatLng(this.center.lat,this.center.lng),t.centerPin),t.url?this.fetchMarkers(t.url,t.pinsImage):void 0},r.prototype.setCenterMarker=function(t,o){return this.centerMarker=new google.maps.Marker({position:t,map:this.map,icon:o,title:"Mi posici√≥n"}),this.bounds.extend(this.centerMarker.getPosition())},r.prototype.fetchMarkers=function(o,e){var r,i;return null==e&&(e=null),r=new n({url:o}),i=this,r.fetch({success:function(){var o;return o=null,r.forEach(function(n,r){var s,p;return i.markers[n.get("id")]=new google.maps.Marker({position:new google.maps.LatLng(n.get("lat"),n.get("lng")),map:i.map,title:"H",icon:e}),p=t.compile(i.opts.popupTemplate),s=p({m:n}),console.log(n),google.maps.event.addListener(i.markers[n.get("id")],"click",function(){var t;o&&o.close(),o=new google.maps.InfoWindow({content:s,disableAutoPan:!1}),o.open(i.map,i.markers[n.get("id")]),t=n}),i.bounds.extend(i.markers[n.get("id")].getPosition())}),i.map.fitBounds(i.bounds)}})},r.prototype.getBrowserGeolocation=function(){return geoPosition.init()?geoPosition.getCurrentPosition(this.storePosition,this.geolocationErrorCallback):console.log("Error al localizar")},r.prototype.storedPosition=function(){var t,o;return t=$.cookie("lat"),o=$.cookie("lng"),t&&o?{lat:t,lng:o}:!1},r.prototype.storePosition=function(t){$.cookie("lat",t.coords.latitude),$.cookie("lng",t.coords.longitude),this.center=this.storedPosition()},r.prototype.geolocationErrorCallback=function(t){return 1===t.code?console.log("Denied by user."):void 0},r}(Backbone.View),window.MapView=e,load_app()})}).call(this);
//# sourceMappingURL=./map.js.map